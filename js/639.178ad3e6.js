"use strict";(self["webpackChunkmumu"]=self["webpackChunkmumu"]||[]).push([[639],{2489:function(t,e,i){var a=i(6518),s=i(9565),r=i(9306),o=i(8551),n=i(1767),c=i(9462),l=i(6319),u=i(6395),h=c((function(){var t,e,i,a=this.iterator,r=this.predicate,n=this.next;while(1){if(t=o(s(n,a)),e=this.done=!!t.done,e)return;if(i=t.value,l(a,r,[i,this.counter++],!0))return i}}));a({target:"Iterator",proto:!0,real:!0,forced:u},{filter:function(t){return o(this),r(t),new h(n(this),{predicate:t})}})},2529:function(t){t.exports=function(t,e){return{value:t,done:e}}},2812:function(t){var e=TypeError;t.exports=function(t,i){if(t<i)throw new e("Not enough arguments");return t}},3579:function(t,e,i){var a=i(6518),s=i(2652),r=i(9306),o=i(8551),n=i(1767);a({target:"Iterator",proto:!0,real:!0},{some:function(t){o(this),r(t);var e=n(this),i=0;return s(e,(function(e,a){if(t(e,i++))return a()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},4603:function(t,e,i){var a=i(6840),s=i(9504),r=i(655),o=i(2812),n=URLSearchParams,c=n.prototype,l=s(c.append),u=s(c["delete"]),h=s(c.forEach),d=s([].push),g=new n("a=1&a=2&b=3");g["delete"]("a",1),g["delete"]("b",void 0),g+""!=="a=2"&&a(c,"delete",(function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return u(this,t);var a=[];h(this,(function(t,e){d(a,{key:e,value:t})})),o(e,1);var s,n=r(t),c=r(i),g=0,f=0,m=!1,v=a.length;while(g<v)s=a[g++],m||s.key===n?(m=!0,u(this,s.key)):f++;while(f<v)s=a[f++],s.key===n&&s.value===c||l(this,s.key,s.value)}),{enumerable:!0,unsafe:!0})},5639:function(t,e,i){i.r(e),i.d(e,{default:function(){return u}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"mobile-game-config"},[e("header",{staticClass:"header-bar"},[e("button",{staticClass:"back-btn",on:{click:t.goBack}},[e("svg",{attrs:{viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"}})])]),e("h1",{staticClass:"header-title"},[t._v("配置设置")]),e("div",{staticClass:"header-placeholder"})]),e("main",{staticClass:"main-content"},[e("div",{ref:"homeview",staticClass:"home-view"},[e("div",{staticClass:"category-list"},t._l(t.categories,(function(i,a){return e("div",{key:a,staticClass:"category-item",class:{"missing-required":t.hasMissingRequiredFields(i)}},[e("div",{staticClass:"category-header"},[e("div",{staticClass:"category-icon",style:{backgroundColor:i.color}},[e("div",{staticClass:"icon-placeholder"},[t._v(t._s(i.name.charAt(0)))])]),e("div",{staticClass:"category-details",on:{click:function(e){return t.toggleCategory(i)}}},[e("h3",[t._v(t._s(i.name))]),t.hasMissingRequiredFields(i)?e("span",{staticClass:"missing-indicator"},[t._v("有未填写项")]):t._e()]),e("div",{staticClass:"category-actions"},[i.type?t._e():e("button",{staticClass:"edit-btn",on:{click:function(e){return e.stopPropagation(),t.editCategory(a)}}},[e("svg",{attrs:{viewBox:"0 0 24 24",width:"16",height:"16"}},[e("path",{attrs:{d:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"}})])]),e("button",{staticClass:"clear-btn",on:{click:function(e){return e.stopPropagation(),t.showClearCategoryConfirm(a)}}},[e("svg",{attrs:{viewBox:"0 0 24 24",width:"16",height:"16"}},[e("path",{attrs:{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"}})])])]),e("div",{staticClass:"category-arrow",on:{click:function(e){return t.toggleCategory(i)}}},[e("svg",{style:{transform:i.expanded?"rotate(180deg)":"rotate(0deg)"},attrs:{viewBox:"0 0 24 24",width:"20",height:"20"}},[e("path",{attrs:{d:"M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"}})])])]),e("transition",{attrs:{name:"slide"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:i.expanded,expression:"category.expanded"}],staticClass:"category-features"},[e("div",{staticClass:"features-grid"},t._l(i.features,(function(i,s){return e("div",{key:s,staticClass:"feature-item",class:{"missing-field":t.isFeatureMissing(i)}},[e("div",{staticClass:"feature-content"},[i.imageUrl?e("div",{staticClass:"feature-image"},[e("img",{attrs:{src:i.imageUrl}})]):e("div",{staticClass:"feature-icon",style:{backgroundColor:i.color}},[t._v(" "+t._s(i.name.charAt(0))+" ")]),e("div",{staticClass:"feature-info"},[e("h4",[t._v(t._s(i.name))]),i.coordinates?e("div",{staticClass:"coordinates"},[e("span",{class:{"missing-value":!i.coordinates.x}},[t._v("X: "+t._s(i.coordinates.x||"未填写"))]),e("span",{class:{"missing-value":!i.coordinates.y}},[t._v("Y: "+t._s(i.coordinates.y||"未填写"))])]):i.imageUrl?t._e():e("div",{staticClass:"missing-value"},[t._v(" 图片未上传 ")])])]),e("div",{staticClass:"feature-actions"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return e.stopPropagation(),t.editFeature(a,s)}}},[e("svg",{attrs:{viewBox:"0 0 24 24",width:"14",height:"14"}},[e("path",{attrs:{d:"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"}})]),e("span",[t._v("编辑")])]),e("button",{staticClass:"clear-btn",on:{click:function(e){return e.stopPropagation(),t.showClearFeatureConfirm(a,s)}}},[e("svg",{attrs:{viewBox:"0 0 24 24",width:"14",height:"14"}},[e("path",{attrs:{d:"M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"}})]),e("span",[t._v("清空")])])])])})),0)])])],1)})),0)])]),e("transition",{attrs:{name:"fade"}},[t.showConfirmDialog?e("div",{staticClass:"confirm-dialog"},[e("div",{staticClass:"dialog-content"},[e("h3",{staticClass:"dialog-title"},[t._v(t._s(t.confirmTitle))]),e("p",{staticClass:"dialog-message"},[t._v(t._s(t.confirmMessage))]),e("div",{staticClass:"dialog-actions"},[e("button",{staticClass:"dialog-btn cancel",on:{click:t.cancelConfirm}},[t._v("取消")]),e("button",{staticClass:"dialog-btn confirm",on:{click:t.executeConfirmAction}},[t._v("确定")])])])]):t._e()]),e("transition",{attrs:{name:"fade"}},[t.showBottomButton?e("button",{staticClass:"bottom-button",on:{click:t.handleBottomButtonClick}},[e("svg",{staticClass:"download-icon",attrs:{viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M19,9H15V3H9V9H5L12,16L19,9M5,18V20H19V18H5Z"}})]),e("span",[t._v("下载文件")])]):t._e()])],1)},s=[],r=(i(4114),i(8111),i(2489),i(7588),i(3579),i(4603),i(7566),i(8721),i(3093)),o={name:"MobileGamePage",data(){return{pickerType:"",tempPickerValue:null,showConfirmDialog:!1,showBottomButton:!1,password:"",confirmTitle:"",confirmMessage:"",pendingAction:null,pendingActionArgs:[],categories:[],downloadKey:""}},async created(){localStorage.getItem(this.getLocalStorageKey())?this.categories=JSON.parse(localStorage.getItem(this.getLocalStorageKey())):(this.categories=await this.decryptData(decodeURIComponent(this.$route.query.categories)),localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(this.categories))),this.password=this.$route.query.password||"",this.downloadKey=this.$route.query.downloadKey||""},mounted(){this.checkEnvironment()},methods:{goBack(){this.$goBackOrHome()},async decryptData(t){if(!t)return[];try{const e=await r.A.decryptJSON(t,"mumuli");return e}catch(e){return this.showNotification("参数获取失败","error"),[]}},getLocalStorageKey(){return this.$route.query.localStorageKey},toggleCategory(t){t.expanded=!t.expanded},async editCategory(t){const e=await r.A.encryptJSON(this.categories[t],"mumuli");this.$router.push({path:"/mark",query:{type:0,setitem:this.getLocalStorageKey(),catIndex:t,str:e}})},async editFeature(t,e){const i=await r.A.encryptJSON(this.categories[t].features[e],"mumuli");this.categories[t].features[e].coordinates?this.$router.push({path:"/mark",query:{type:1,setitem:this.getLocalStorageKey(),catIndex:t,featIndex:e,str:i}}):this.$router.push({path:"/cropping",query:{type:1,catIndex:t,featIndex:e,str:JSON.stringify(this.categories[t].features[e])}})},hasMissingRequiredFields(t){return t.features.some((t=>this.isFeatureMissing(t)))},isFeatureMissing(t){return t.coordinates?null===t.coordinates.x||null===t.coordinates.y:!t.imageUrl},showClearCategoryConfirm(t){this.confirmTitle="清空分类内容",this.confirmMessage="确定要清空此分类下的所有坐标和图片吗？",this.pendingAction=this.clearCategory,this.pendingActionArgs=[t],this.showConfirmDialog=!0},showClearFeatureConfirm(t,e){this.confirmTitle="清空功能项",this.confirmMessage="确定要清空此项的坐标或图片吗？",this.pendingAction=this.clearFeature,this.pendingActionArgs=[t,e],this.showConfirmDialog=!0},executeConfirmAction(){this.pendingAction&&this.pendingAction(...this.pendingActionArgs),localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(this.categories)),this.showConfirmDialog=!1},cancelConfirm(){this.showConfirmDialog=!1},clearCategory(t){this.categories[t].features.forEach((t=>{t.coordinates&&(t.coordinates.x=null,t.coordinates.y=null),t.imageUrl&&(t.imageUrl=null)})),this.showNotification("分类内容已清空","success")},clearFeature(t,e){const i=this.categories[t].features[e];i.coordinates&&(i.coordinates.x=null,i.coordinates.y=null),i.imageUrl&&(i.imageUrl=null),this.showNotification("内容已清空","success")},clearAll(){this.categories.forEach((t=>{t.features.forEach((t=>{t.coordinates&&(t.coordinates.x=null,t.coordinates.y=null),t.imageUrl&&(t.imageUrl=null)}))})),this.showNotification("所有内容已清空","success")},showNotification(t,e="success"){this.$toast(t,e)},checkEnvironment(){const t=/MicroMessenger/i.test(navigator.userAgent),e=/Android/i.test(navigator.userAgent);this.showBottomButton=!t&&!e,this.showBottomButton?this.$refs.homeview.style.padding="0 0 40px":this.$refs.homeview.style.padding="0"},async handleBottomButtonClick(){try{const t=this.categories.filter((t=>this.hasMissingRequiredFields(t)));if(t.length>0)return t.forEach((t=>{t.expanded=!0})),void this.showNotification("请先填写所有必填项","error");const e=await r.A.encryptJSON(this.categories,this.password);this.downloadEncryptedData(e),this.showNotification("配置已加密下载","success")}catch(t){this.showNotification("加密失败: "+t.message,"error")}},downloadEncryptedData(t){try{const e=new Blob([t],{type:"text/plain"}),i=URL.createObjectURL(e),a=document.createElement("a");a.href=i,a.download=`${this.downloadKey||"limumu"}.txt`,document.body.appendChild(a),a.click(),setTimeout((()=>{document.body.removeChild(a),URL.revokeObjectURL(i)}),100)}catch(e){this.showNotification("创建下载失败","error")}}}},n=o,c=i(1656),l=(0,c.A)(n,a,s,!1,null,"2d08887e",null),u=l.exports},6279:function(t,e,i){var a=i(6840);t.exports=function(t,e,i){for(var s in e)a(t,s,e[s],i);return t}},6319:function(t,e,i){var a=i(8551),s=i(9539);t.exports=function(t,e,i,r){try{return r?e(a(i)[0],i[1]):e(i)}catch(o){s(t,"throw",o)}}},7566:function(t,e,i){var a=i(6840),s=i(9504),r=i(655),o=i(2812),n=URLSearchParams,c=n.prototype,l=s(c.getAll),u=s(c.has),h=new n("a=1");!h.has("a",2)&&h.has("a",void 0)||a(c,"has",(function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return u(this,t);var a=l(this,t);o(e,1);var s=r(i),n=0;while(n<a.length)if(a[n++]===s)return!0;return!1}),{enumerable:!0,unsafe:!0})},7588:function(t,e,i){var a=i(6518),s=i(2652),r=i(9306),o=i(8551),n=i(1767);a({target:"Iterator",proto:!0,real:!0},{forEach:function(t){o(this),r(t);var e=n(this),i=0;s(e,(function(e){t(e,i++)}),{IS_RECORD:!0})}})},8721:function(t,e,i){var a=i(3724),s=i(9504),r=i(2106),o=URLSearchParams.prototype,n=s(o.forEach);a&&!("size"in o)&&r(o,"size",{get:function(){var t=0;return n(this,(function(){t++})),t},configurable:!0,enumerable:!0})},9462:function(t,e,i){var a=i(9565),s=i(2360),r=i(6699),o=i(6279),n=i(8227),c=i(1181),l=i(5966),u=i(7657).IteratorPrototype,h=i(2529),d=i(9539),g=n("toStringTag"),f="IteratorHelper",m="WrapForValidIterator",v=c.set,p=function(t){var e=c.getterFor(t?m:f);return o(s(u),{next:function(){var i=e(this);if(t)return i.nextHandler();if(i.done)return h(void 0,!0);try{var a=i.nextHandler();return i.returnHandlerResult?a:h(a,i.done)}catch(s){throw i.done=!0,s}},return:function(){var i=e(this),s=i.iterator;if(i.done=!0,t){var r=l(s,"return");return r?a(r,s):h(void 0,!0)}if(i.inner)try{d(i.inner.iterator,"normal")}catch(o){return d(s,"throw",o)}return s&&d(s,"normal"),h(void 0,!0)}})},y=p(!0),C=p(!1);r(C,g,"Iterator Helper"),t.exports=function(t,e,i){var a=function(a,s){s?(s.iterator=a.iterator,s.next=a.next):s=a,s.type=e?m:f,s.returnHandlerResult=!!i,s.nextHandler=t,s.counter=0,s.done=!1,v(this,s)};return a.prototype=e?y:C,a}}}]);