"use strict";(self["webpackChunkmumu"]=self["webpackChunkmumu"]||[]).push([[225],{4225:function(t,e,s){s.r(e),s.d(e,{default:function(){return C}});var n=function(){var t=this,e=t._self._c;return e("div",[e("PeerConnection")],1)},o=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"webrtc-app"},[e("header",{staticClass:"header-bar"},[e("button",{staticClass:"back-btn",on:{click:t.goBack}},[e("svg",{attrs:{viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"}})])]),e("h1",{staticClass:"header-title"},[t._v(t._s(t.pageTitle))]),e("div",{staticClass:"header-placeholder"})]),e("main",{staticClass:"app-main"},[e("div",{staticClass:"connection-status"},[e("div",{staticClass:"status-indicator",class:t.connectionStatusClass},[t._v(" "+t._s(t.connectionStatusText)+" ")]),e("div",{staticClass:"peer-id-display"},[e("span",[t._v("你的ID: "),e("strong",[t._v(t._s(t.peerId))])]),e("button",{staticClass:"copy-btn",on:{click:t.copyPeerId}},[e("svg",{staticClass:"copy-icon",attrs:{viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"}})]),t._v(" 复制 ")])])]),e("div",{staticClass:"connection-controls"},[e("div",{staticClass:"connect-input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.remotePeerId,expression:"remotePeerId"}],attrs:{placeholder:"输入对方ID",disabled:t.isConnected},domProps:{value:t.remotePeerId},on:{input:function(e){e.target.composing||(t.remotePeerId=e.target.value)}}}),e("button",{staticClass:"connect-btn",attrs:{disabled:!t.remotePeerId||t.isConnected},on:{click:t.connectToPeer}},[t._v(" 连接 ")])]),e("button",{staticClass:"disconnect-btn",attrs:{disabled:!t.isConnected},on:{click:t.disconnect}},[t._v(" 断开连接 ")])]),e("div",{staticClass:"message-area"},[e("div",{ref:"messageContainer",staticClass:"message-container"},t._l(t.messages,(function(s,n){return e("div",{key:n,class:["message",s.type],style:{marginBottom:n<t.messages.length-1?"1rem":"0"}},[e("div",{staticClass:"message-content"},[e("span",{staticClass:"message-sender"},[t._v(t._s(s.sender))]),e("span",{staticClass:"message-text"},[t._v(t._s(s.text))]),e("span",{staticClass:"message-time"},[t._v(t._s(s.time))])])])})),0)]),e("div",{staticClass:"message-input-area"},[e("button",{staticClass:"send-btn",attrs:{disabled:!t.isConnected||!t.newMessage},on:{click:t.sendMessage}},[t._v(" 发送 ")])])]),t._m(0),e("transition",{attrs:{name:"fade"}},[t.showToast?e("div",{staticClass:"toast",class:t.toastType},[e("svg",{staticClass:"toast-icon",attrs:{viewBox:"0 0 24 24"}},["success"===t.toastType?e("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}}):t._e(),"error"===t.toastType?e("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}}):t._e()]),e("span",{staticClass:"toast-message"},[t._v(t._s(t.toastMessage))])]):t._e()])],1)},a=[function(){var t=this,e=t._self._c;return e("footer",{staticClass:"app-footer"},[e("div",{staticClass:"footer-note"},[e("p",[t._v("© 沐沐同步工具")])])])}],c=(s(4114),s(5575)),r={name:"WebRTCApp",data(){return{peer:null,peerId:"",remotePeerId:"",connection:null,messages:[],newMessage:"",connectionStatus:"disconnected",showToast:!1,toastMessage:"",toastType:"success",pageTitle:""}},created(){this.pageTitle=this.$route.query.name},computed:{isConnected(){return"connected"===this.connectionStatus},connectionStatusText(){const t={disconnected:"未连接",connecting:"连接中...",connected:"已连接"};return t[this.connectionStatus]},connectionStatusClass(){return this.connectionStatus}},mounted(){this.initializePeer()},methods:{goBack(){this.$goBackOrHome()},initializePeer(){this.peer=new c.Ay({host:"0.peerjs.com",port:443,secure:!0,debug:3}),this.peer.on("open",(t=>{this.peerId=t,this.showNotification("已准备好连接","success")})),this.peer.on("connection",(t=>{this.handleIncomingConnection(t)})),this.peer.on("error",(t=>{console.error("Peer error:",t),this.showNotification("连接错误","error"),this.connectionStatus="disconnected"}))},connectToPeer(){if(!this.remotePeerId)return;this.connectionStatus="connecting",this.addSystemMessage(`正在连接 ${this.remotePeerId}...`);const t=this.peer.connect(this.remotePeerId);this.handleOutgoingConnection(t)},handleIncomingConnection(t){this.connection=t,this.setupConnectionHandlers(),this.connectionStatus="connected",this.addSystemMessage(`${t.peer} 已连接`)},handleOutgoingConnection(t){this.connection=t,this.setupConnectionHandlers(),t.on("open",(()=>{this.connectionStatus="connected",this.addSystemMessage(`已连接到 ${t.peer}`)}))},setupConnectionHandlers(){this.connection.on("data",(t=>{this.addMessage("对方",t,"remote")})),this.connection.on("close",(()=>{this.addSystemMessage("连接已关闭"),this.connectionStatus="disconnected",this.connection=null})),this.connection.on("error",(t=>{console.error("Connection error:",t),this.addSystemMessage(`连接错误: ${t.message}`),this.connectionStatus="disconnected"}))},disconnect(){this.connection&&this.connection.close(),this.connectionStatus="disconnected",this.connection=null},sendMessage(){if(this.newMessage.trim()&&this.connection)try{this.connection.send(this.newMessage),this.addMessage("我",this.newMessage,"local"),this.newMessage=""}catch(t){this.showNotification("发送失败","error")}},addMessage(t,e,s){this.messages.push({sender:t,text:e,type:s,time:(new Date).toLocaleTimeString()}),this.scrollToBottom()},addSystemMessage(t){this.addMessage("系统",t,"system")},scrollToBottom(){this.$nextTick((()=>{const t=this.$el.querySelector(".message-container");t.scrollTop=t.scrollHeight}))},copyPeerId(){navigator.clipboard.writeText(this.peerId).then((()=>this.showNotification("ID已复制到剪贴板","success"))).catch((()=>this.showNotification("复制失败","error")))},showNotification(t,e="success"){this.toastMessage=t,this.toastType=e,this.showToast=!0,setTimeout((()=>{this.showToast=!1}),3e3)}},beforeDestroy(){this.connection&&this.connection.close(),this.peer&&this.peer.destroy()}},d=r,l=s(1656),h=(0,l.A)(d,i,a,!1,null,"67f04c67",null),u=h.exports,p={name:"App",components:{PeerConnection:u}},m=p,g=(0,l.A)(m,n,o,!1,null,null,null),C=g.exports}}]);
//# sourceMappingURL=225.223c67c8.js.map